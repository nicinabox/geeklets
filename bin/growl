#!/usr/bin/env ruby
require 'trollop'

opts = Trollop::options do
  opt :message,   "Message to display", :required => true, :type => String
  opt :sticky,    "Stays on screen until dismissed", :default => "no"
  opt :nosticky,  "Goes away after several seconds."
  opt :priority,  "Priority -2,-1,0,1,2", :type => Integer, :default => 0 
  opt :verylow,   "priority [-2]"
  opt :moderate,  "priority [-1]"
  opt :normal,    "priority  [0]", :default => true 
  opt :high,      "priority  [1]"
  opt :emergency, "priority  [2]"
  opt :title,     "Used as the Growl message title.", :default => "Notification"
  opt :application, "Used as the Growl message title.", :default => "Shell Script Growl Message"
  opt :icon,      "Display this application's icon", :default => "Terminal.app"
end

description = opts
string = <<-EOD
tell application "GrowlHelperApp"
   -- Make a list of all the notification types that this script will ever send:
   set the allNotificationsList to {"#{opts[:application]}"}

   -- Make a list of the notifications that will be enabled by default.      
   -- Those not enabled by default can be enabled later in the 'Applications'
   -- tab of the growl prefpane.
   set the enabledNotificationsList to {"#{opts[:application]}"}

   -- Register our script with growl.  You can optionally (as here) set a
   -- default icon for this script's notifications.
   register as application "#{opts[:application]}" all notifications allNotificationsList default notifications enabledNotificationsList icon of application "#{opts[:icon]}"

   -- Send a Notification...
   notify with name "#{opts[:application]}" title "#{opts[:title]}" description "#{opts[:message]}" application name "#{opts[:application]}" sticky #{opts[:sticky]} priority #{opts[:priority]}

end tell
EOD

`osascript <<-EOD
#{string}
EOD`